WITH QUERY_T1 AS
	(SELECT CUST,
			MAX(QUANT) AS MAX1
		FROM SALES
		WHERE STATE = 'NJ'
		GROUP BY CUST
		ORDER BY CUST),
	QUERY_T2 AS
	(SELECT SALES.CUST,
			MAX(QUANT) AS MAX2
		FROM SALES
		JOIN QUERY_T1 ON QUERY_T1.CUST = SALES.CUST
		WHERE STATE = 'NJ'
			AND QUANT != MAX1
		GROUP BY SALES.CUST
		ORDER BY SALES.CUST),
	QUERY_T3 AS
	(SELECT SALES.CUST,
			MAX(QUANT) AS MAX3
		FROM SALES
		JOIN QUERY_T1 ON QUERY_T1.CUST = SALES.CUST
		JOIN QUERY_T2 ON QUERY_T2.CUST = SALES.CUST
		WHERE STATE = 'NJ'
			AND QUANT != MAX1
			AND QUANT != MAX2
		GROUP BY SALES.CUST
		ORDER BY SALES.CUST),
	QUERY_T4 AS
	(SELECT SALES.CUST,
			SALES.QUANT,
			SALES.PROD,
			SALES.DATE
		FROM SALES
		JOIN QUERY_T1 ON QUERY_T1.CUST = SALES.CUST
			AND SALES.QUANT = MAX1
			AND STATE = 'NJ'),
	QUERY_T5 AS
	(SELECT SALES.CUST,
			SALES.QUANT,
			SALES.PROD,
			SALES.DATE
		FROM SALES
		JOIN QUERY_T2 ON QUERY_T2.CUST = SALES.CUST
			AND SALES.QUANT = MAX2
			AND STATE = 'NJ'),
	QUERY_T6 AS
	(SELECT SALES.CUST,
			SALES.QUANT,
			SALES.PROD,
			SALES.DATE
		FROM SALES
		JOIN QUERY_T3 ON QUERY_T3.CUST = SALES.CUST
			AND SALES.QUANT = MAX3
			AND STATE = 'NJ')
SELECT CUST AS "CUSTOMER",
	   QUANT AS "QUANTITY",
	   PROD AS "PRODUCT",
	   DATE AS "DATE"
	FROM QUERY_T4
UNION
SELECT CUST AS "CUSTOMER",
	   QUANT AS "QUANTITY",
	   PROD AS "PRODUCT",
	   DATE AS "DATE"
	FROM QUERY_T5
UNION
SELECT CUST AS "CUSTOMER",
	   QUANT AS "QUANTITY",
	   PROD AS "PRODUCT",
	   DATE AS "DATE"
	FROM QUERY_T6
	ORDER BY "CUSTOMER",
		 "QUANTITY",
		 "PRODUCT",
		 "DATE"